<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="css/style.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <script src="lib/FileSaver.js"></script>
    <script src="lib/Turndown.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.0/showdown.min.js"></script>

</head>

<body>
    <div class="col-sm-3"></div>
    <div class="col-sm-6">
        <h1>HTML - MD Converter</h1>
        <h3>HTML&rarr;MD</h3>
        <div class="form-container">
            <form action="/action_page.php">
                <input type="file" id="mInput" class="input" name="filename">
            </form>
            <button id="download" onclick="downloadFile()">Convert</button>
        </div>
        <h3>MD&rarr;HTML</h3>
        <div class="form-container">
            <form action="/action_page.php">
                <input type="file" id="hInput" class="input" name="filename">
            </form>
            <button id="download2" onclick="downloadFile()">Convert</button>
        </div>
        <p>Created with <a href="https://github.com/domchristie/turndown">Turndown</a>, <a href="https://github.com/showdownjs/showdown">Showdown</a>, and <a href="https://github.com/eligrey/FileSaver.js/">FileSaver</a>.</p>
    </div>

<script>
    ////////to MD////////////
    var markdown;
    var turndownService = new TurndownService();
    
    const mInput = document.getElementById("mInput");

    mInput.addEventListener("change", handleHtml, false);
    function handleHtml() {
        const fileList = this.files; /* now you can work with the file list */

        const numFiles = fileList.length;

        for (let i = 0, numFiles = fileList.length; i < numFiles; i++) {
            const file = fileList[i];
            var fileContents;

            Promise.resolve(file.text()).then(function(data){
                fileContents = data.toString();
                markdown = turndownService.turndown(fileContents);
            });
        }
    }

    ////////to html////////////    
    var html;
    var converter = new showdown.Converter();
    
    const hInput = document.getElementById("hInput");

    hInput.addEventListener("change", handleMd, false);

    function handleMd() {
        const fileList = this.files; /* now you can work with the file list */

        const numFiles = fileList.length;

        for (let i = 0, numFiles = fileList.length; i < numFiles; i++) {
            const file = fileList[i];
            var fileContents;

            Promise.resolve(file.text()).then(function(data){
                fileContents = data.toString();
                html  = converter.makeHtml(fileContents);
            });
        }
    }

    ////////file download////////////   
    function downloadFile(type){
        if (markdown){
            var saveFile = new File([markdown], "markdown.md", {});
            saveAs(saveFile);
            markdown = null;
            mInput.value = "";
        }
        else if (html){
            var saveFile = new File([html], "index.html", {});
            saveAs(saveFile);
            html = null;
            hInput.value = "";
        }
        else
            alert("No File Selected!");
    }
</script>

</body>

</html>